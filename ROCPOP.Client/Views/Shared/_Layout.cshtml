@inject Microsoft.ApplicationInsights.AspNetCore.JavaScriptSnippet JavaScriptSnippet
<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>ROC CITY POPCORN</title>

    <link href="~/lib/bootstrap/dist/css/bootstrap.css" rel="stylesheet" />
    <link href="~/lib/font-awesome/css/font-awesome.css" rel="stylesheet" />
    <link href="~/organik_theme/css/ionicons.min.css" rel="stylesheet" />
    <link href="~/organik_theme/css/owl.carousel.css" rel="stylesheet" />
    <link href="~/organik_theme/css/owl.theme.css" rel="stylesheet" />
    @*<link href="~/organik_theme/css/prettyPhoto.css" rel="stylesheet" />*@
    <link href="~/organik_theme/css/settings.css" rel="stylesheet" />
    <link href="~/organik_theme/css/style.css" rel="stylesheet" />
    <link href="~/css/Override.css" rel="stylesheet" />
    <link href="//fonts.googleapis.com/css?family=Great+Vibes%7CLato:100,100i,300,300i,400,400i,700,700i,900,900i" rel="stylesheet" />
    @*@Html.Raw(JavaScriptSnippet.FullScript)*@
</head>
<body>
    @*<nav class="navbar navbar-inverse navbar-fixed-top">
        <div class="container">
            <div class="navbar-header">
                <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                    <span class="sr-only">Toggle navigation</span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                </button>
                <a asp-area="" asp-controller="Home" asp-action="Index" class="navbar-brand">ROCPOP.Client</a>
            </div>
            <div class="navbar-collapse collapse">
                <ul class="nav navbar-nav">
                    <li><a asp-area="" asp-controller="Home" asp-action="Index">Home</a></li>
                    <li><a asp-area="" asp-controller="Home" asp-action="About">About</a></li>
                    <li><a asp-area="" asp-controller="Home" asp-action="Contact">Contact</a></li>
                </ul>
            </div>
        </div>
    </nav>*@
    @Html.Partial("Topbar")
    <div class="site">
        @*@Html.Partial("Nav_Mobile")*@
        @Html.Partial("Nav")
        @*@Html.Partial("Nav_Mobile2")*@
        <div id="main">
            @RenderBody()          
        </div>

        @Html.Partial("Footer")
    </div>

    @* ----------------------------------------- *@
    @* ---------------- Modal ------------------ *@
    @* ----------------------------------------- *@
    <div id="ProductModal" class="modal fade" role="dialog">
        <div class="modal-dialog">
            <div id="ThisProduct" class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal">&times;</button>
                </div>
                <div id="ProdId"  class="modal-body">
                    <div class="row">
                        <div class="col-md-6">
                            <div class="main-image">
                                <div class="main-image-container">
                                    <img src="~/images/freshpopcorn_260.jpg" />
                                </div>
                            </div>
                            <div>
                                <div class="col-xs-3">
                                    <img src="~/organik_theme/images/shop/shop_100x100.jpg" />
                                </div>
                                <div class="col-xs-3">
                                    <img src="~/organik_theme/images/shop/shop_100x100.jpg" />
                                </div>
                                <div class="col-xs-3">
                                    <img src="~/organik_theme/images/shop/shop_100x100.jpg" />
                                </div>
                                <div class="col-xs-3">
                                    <img src="~/organik_theme/images/shop/shop_100x100.jpg" />
                                </div>
                            </div>
                        </div>
                        <div class="col-md-6" style="margin-bottom:30px">
                            <h4 data-bind="text: productName"></h4>
                            <p class="body-text">
                                Picture yourself in a kaleidoscope of flavor. Here, sea salt and cracked black pepper skies rain crunchy kernels that bring taste buds to attention! Only the Sergeant can call order to the diamond-bright smiles ahead!
                            </p>
                            <div class="row">
                                <div class="col-md-6">
                                    <label>Choose a Size:</label>
                                    <select id="ProdOpt" class="form-control" data-bind="options:  products, selectedOptions: selectedProduct,
                                       optionsText: 'name',
                                       optionsValue: 'price',
                                       value: unitPrice">
                                    </select>
                                </div>
                                <div class="col-md-6">
                                    <label>Enter Qty:</label>
                                    <input id="ProdQTY" class="form-control" type="number" data-bind="value: qty,valueUpdate:'afterkeydown'" min="1" />
                                </div>
                            </div>
                        </div>
                        <h5 id="ProdPrice" style="position: absolute;bottom: 6px; right:40px" class="ext-price">$<span data-bind="text: extPrice"></span></h5>
                    </div>
                </div>
                <div class="modal-footer">
                    <button id="AddToCart" type="button" class="btn btn-success" data-dismiss="modal">Add To Cart</button>
                </div>
            </div>
        </div>
        </div>
        <script src="~/lib/jquery/dist/jquery.min.js"></script>
        @*<script src="~/lib/jquery-migrate/jquery-migrate.js"></script>*@
        <script src="~/lib/bootstrap/dist/js/bootstrap.min.js"></script>
        <script src="~/lib/knockout/dist/knockout.js"></script>
        <script src="~/organik_theme/js/imagesloaded.pkgd.min.js"></script>
        <script src="~/organik_theme/js/core.min.js"></script>
        <script src="~/organik_theme/js/isotope.pkgd.min.js"></script>
        <script src="~/organik_theme/js/jquery.prettyPhoto.init.min.js"></script>
        <script src="~/organik_theme/js/jquery.prettyPhoto.js"></script>
        @*<script src="~/organik_theme/js/price-slider.js"></script>*@
        <script src="~/organik_theme/js/slick.min.js"></script>
        <script src="~/lib/modernizer/modernizr.js"></script>
        @*<script src="~/organik_theme/js/slider.min.js"></script>*@
        <script src="~/organik_theme/js/widget.min.js"></script>
        @*<script src="~/lib/owl-carousel/owl-carousel/owl.carousel.js"></script>*@
        <script src="~/lib/jquery.countdown/dist/jquery.countdown.js"></script>
        <script src="~/js/script.js"></script>

        <script src="~/organik_theme/js/jquery.themepunch.tools.min.js"></script>
        <script src="~/organik_theme/js/jquery.themepunch.revolution.min.js"></script>
        <script src="~/organik_theme/js/ext/revolution.extension.slideanims.min.js"></script>
        <script src="~/organik_theme/js/ext/revolution.extension.actions.min.js"></script>
        <script src="~/organik_theme/js/ext/revolution.extension.layeranimation.min.js"></script>
        <script src="~/organik_theme/js/ext/revolution.extension.kenburn.min.js"></script>
        <script src="~/organik_theme/js/ext/revolution.extension.navigation.min.js"></script>
        <script src="~/organik_theme/js/ext/revolution.extension.migration.min.js"></script>
        <script src="~/organik_theme/js/ext/revolution.extension.parallax.min.js"></script>
        @RenderSection("Scripts", required: false)
        <script>


            // Get the product partial page. partial page gets loaded into modal
            var cart = new Array();

            $.ajax({
                url: '/Product/GetSessionCart',
                datatype: 'json',
                type: 'POST',
            }).done(function (data) {
                cart = data;
            });

            // Get product and show in modal
            $("#main").on("click", ".prod-info", function (e) {
                var prodId = $(this).data().prod;
                //$("#ThisProduct").show();
                //$("#ThisProduct").load("/Product/GetProductOrderForm?id=" + prodId);
                $.ajax({
                    url: "/Product/GetProduct",
                    datatype: "JSON",
                    type: "GET",
                    data: { id: prodId },
                }).done(function (data) {
                    productName(data.name);
                    productId(data.id);
                    products([]);
                    //prodcart.productDesc = data.description
                    addProduct('Small', data.priceSmall);
                    addProduct('Medium', data.priceMedium);
                    addProduct('Large', data.priceLarge);
                    qty(1);
                    $("#ThisProduct").show();
                });
            });


        var Product = function (name, price) {
            this.name = name;
            this.price = price;
        };

        // model
        var prodCart = function CartViewModel() {
            this.products = ko.observableArray([

            ]),
            this.addProduct = function (itemSize, itemPrice) {
                this.products.push({ name: itemSize + " - $" + itemPrice.toFixed(2), price: JSON.stringify(itemPrice) }); //JSON.stringify(itemPrice)
            }
            this.selectedProduct = ko.observableArray([]);
            this.productId = ko.observable();
            this.productName = ko.observable();
            this.productDesc = ko.observable();
            this.unitPrice = ko.observable();
            this.qty = ko.observable(1);
            this.size = ko.observable("SM");
            this.extPrice = ko.computed(function () {
                var q = Number(this.qty());
                if (q <= 0) {
                    this.qty(1);
                    q = 1;
                }
                return parseFloat(this.unitPrice() * q).toFixed(2)
            }, this).extend({ notify: 'always' });
        };
        ko.applyBindings(prodCart);

        //Add to Cart
        $("#ThisProduct").on("click", "#AddToCart", function (e) {
            var cartItemCount = $(".mini-cart-icon").data().count + 1;
            // html not updating work around to update shopping cart number
            $(".mini-cart").html('<div class="mini-cart-icon" data-count="' + cartItemCount + '"><i class="ion-bag"></i> </div>')

            var prod = $("#ProdId").data();
            var name = productName();
            // send info to controller
            var prodid = productId();
            var name = productName();
            var q = qty();
            var unitprice = $(".prod-size").val();
            //console.log(selectedProduct());
            var selectedText = $("#ProdOpt option:selected").text()
            var s = selectedText.substring(0, selectedText.indexOf(' '));
            var price = $("#ProdOpt").val();

            cart.push({ "ProdId": prodid, "Name": name, "Size": s, "Price": price, "Qty": q });
            // to do: send to controller
            $.ajax({
                url: '/Product/StoreSessionCart',
                datatype: 'html',
                type: 'POST',
                data: { "cart": JSON.stringify(cart) }
            }).done(function (data) {
                //console.log(data);
                $(".mini-cart-wrap").html(data);
            });
        });

        // get cart and populate drop down cart
        if ('@ViewBag.serializedCart') {
        $.ajax({
            url: '/Product/StoreSessionCart',
            datatype: 'html',
            type: 'POST',
            data: { "cart": "" }
        }).done(function (data) {
            //console.log(data);
            $(".mini-cart-wrap").html(data);
        });
        }

           
        </script>
</body>
</html>
